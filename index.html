<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Testnet BTC TimeLock Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@3.3.2/dist/bitcoinjs-lib.min.js"></script>
  <style>
    body { font-family: monospace; padding: 20px; background: #111; color: #0f0; }
    input, button { padding: 8px; background: #222; color: #0f0; border: 1px solid #0f0; }
    .box { margin-top: 20px; padding: 10px; background: #222; border: 1px solid #0f0; }
    label { display: inline-block; width: 240px; }
  </style>
</head>
<body>
  <h2>ğŸ” Time-Locked BTC Testnet Address</h2>

  <label>â³ UNIX Timestamp (locktime):</label>
  <input type="number" id="locktime" value="1750000000" oninput="updateDate()">
  <span id="humandate"></span>
  <br>
  <label>ğŸ“… Ğ˜Ğ»Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ´Ğ°Ñ‚Ñƒ:</label>
  <input type="datetime-local" id="localdatetime" onchange="setUnixFromDate()">
  <br><br>
  <button onclick="generate()">ğŸ² Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ</button>

  <div class="box" id="output" style="display:none;">
    <p><strong>ğŸ”‘ WIF:</strong> <span id="wif"></span></p>
    <p><strong>ğŸ“¢ Public key:</strong> <span id="pubkey"></span></p>
    <p><strong>ğŸ§¾ Redeem script:</strong> <span id="redeem"></span></p>
    <p><strong>ğŸ“¬ P2SH Testnet Address:</strong> <span id="address"></span></p>
  </div>

  <script>
    function updateDate() {
      const ts = parseInt(document.getElementById("locktime").value);
      if (!isNaN(ts)) {
        const date = new Date(ts * 1000);
        document.getElementById("humandate").innerText = "ğŸ•’ " + date.toLocaleString();
        document.getElementById("localdatetime").value = date.toISOString().slice(0,16);
      } else {
        document.getElementById("humandate").innerText = "";
      }
    }

    function setUnixFromDate() {
      const input = document.getElementById("localdatetime").value;
      const ts = Math.floor(new Date(input).getTime() / 1000);
      document.getElementById("locktime").value = ts;
      updateDate();
    }

    function generate() {
      updateDate();

      const locktime = parseInt(document.getElementById("locktime").value);
      if (isNaN(locktime)) return alert("ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ locktime");

      const now = Math.floor(Date.now() / 1000);
      if (locktime < now) return alert("âš ï¸ Ğ”Ğ°Ñ‚Ğ° Ğ² Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¼");

      const network = bitcoin.networks.testnet;
      const keyPair = bitcoin.ECPair.makeRandom({ network });
      const pubkey = keyPair.getPublicKeyBuffer();
      const wif = keyPair.toWIF();

      const script = bitcoin.script.compile([
        bitcoin.script.number.encode(locktime),
        bitcoin.opcodes.OP_CHECKLOCKTIMEVERIFY,
        bitcoin.opcodes.OP_DROP,
        pubkey,
        bitcoin.opcodes.OP_CHECKSIG,
      ]);

      const { address } = bitcoin.payments.p2sh({ redeem: { output: script, network }, network });

      document.getElementById("output").style.display = "block";
      document.getElementById("wif").innerText = wif;
      document.getElementById("pubkey").innerText = pubkey.toString("hex");
      document.getElementById("redeem").innerText = script.toString("hex");
      document.getElementById("address").innerText = address;
    }

    window.onload = updateDate;
  </script>
</body>
</html>
